<html>

<head>
    <!-- Load Daily.co JavaScript library -->
    <script crossorigin src="https://unpkg.com/@daily-co/daily-js"></script>
    <style>
        /* Custom CSS for buttons and layout */
        .btn {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }

        .btn:disabled {
            background-color: #888;
            cursor: not-allowed;
        }
    </style>
</head>

<body>
    <!-- Beautiful Button -->
    <button id="start-conversation" class="btn">
        Start Conversation
    </button>
    <div id="conversation-link" style="margin-top: 20px;"></div>

    <script>
        // API details configuration
        const API_CONFIG = {
            url: "https://tavusapi.com/v2/conversations",
            apiKey: "624b8c020e374121a8439c0ac6659460",
            replicaId: "r79e1c033f",    // Customizable replica ID
            personaId: "p64ababa",       // Customizable persona ID
            callbackUrl: "https://xxx.app/webhook", // Customizable callback URL
            conversationName: "A Meeting with Gaby", // Default conversation name
            maxCallDuration: 3600,       // Maximum call duration in seconds
            participantLeftTimeout: 60,  // Timeout for participant left in seconds
            enableRecording: false       // Option to enable/disable recording
        };

        // Event listener for starting the conversation
        document.getElementById("start-conversation").addEventListener("click", async function () {
            // Disable the button to prevent multiple clicks
            this.disabled = true;

            // Create the request data object
            const requestData = {
                replica_id: API_CONFIG.replicaId,
                persona_id: API_CONFIG.personaId,
                callback_url: API_CONFIG.callbackUrl,
                conversation_name: API_CONFIG.conversationName,
                conversational_context: "", // Optionally pass conversational context
                custom_greeting: "",         // Optionally pass a custom greeting
                properties: {
                    max_call_duration: API_CONFIG.maxCallDuration,
                    participant_left_timeout: API_CONFIG.participantLeftTimeout,
                    enable_recording: API_CONFIG.enableRecording
                }
            };

            try {
                const response = await fetch(API_CONFIG.url, {
                    method: "POST",
                    headers: {
                        "x-api-key": API_CONFIG.apiKey,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                const conversationUrl = result.conversation_url;

                document.getElementById("conversation-link").innerHTML = `
                    <p>Conversation started! Click the link below to join:</p>
                    <a href="${conversationUrl}" target="_blank">${conversationUrl}</a>
                `;

                const call = window.Daily.createFrame();
                call.join({ url: conversationUrl });

            } catch (error) {
                console.error("There was an error with the API request:", error);
                document.getElementById("conversation-link").innerHTML = `
                    <p style="color:red;">Failed to start the conversation: ${error.message}</p>
                `;
            } finally {
                document.getElementById("start-conversation").disabled = false;
            }
        });
    </script>
</body>

</html>